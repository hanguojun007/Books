---
title: "Data tidying.qmd"
author: "大番薯本薯"
date: "2025-01-21"
date-modified: "2025-01-21"
format: "html"
fig-width: 4
fig-height: 4
fig-align: center
execute:
  warning: false
---

# Data tidying

本章主要学习使用`tidyr`包中的`piot_longer()`和`pivot_wider()`进行数据整理。

## Tidy data

tidy data 是数据整理的标准，它使数据更容易在R中操作、建模和可视化。tidy 数据有三个特定：

-   每个变量占一列
-   每个观测占一行
-   每个值占一个单元格

![](image/tidy-1.png)

我们常见的基因表达矩阵需要转置才能满足tidy data的要求。

## Lengthening data

所谓长数据就是每一行一个观测，一个变量，一个值。即：

|sample|gene|expression|
|------|----|----------|
|A|gene1|1.2|
|A|gene2|1.3|
|B|gene1|1.4|
|B|gene2|1.5|

::: {.callout-tip}
实际处理数据过程中，什么是观测，什么是变量，要视数据分析目的而定。
:::

### pivot_longer()

`piovt_longer()` 函数的参数如下：

-   `data`: 数据框。
-   `cols`：需要转换的列，可以使用select()函数中的语法。
-   `cols_vary`：转换后的行顺序排列方法，默认是"fastest"，即按照行的顺序排列；"slowest"则是按照列的顺序排列。
-   `names_to`：转换后的列名，可以是一个字符串，也可以是一个字符向量，作用不同。
-   `values_to`：转换后的值列名
-   `names_sep`：列名分隔符
-   `names_pattern`：列名正则表达式
-   `values_drop_na`：是否删除NA值的行，默认是FALSE。










```{r}
pivot_longer()
pivot_wider()
library(tidyverse)
who2 |>
  pivot_longer(
    cols = !(country:year),
    names_to = c("diagnosis", "gender", "age"),
    names_sep = "_",
    values_to = "count",
    cols_vary = "slowest",
    values_drop_na = TRUE
  )

```